!function(a){a.fn.serializeObject=function(){var b=this,c={},d={},f=/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,h=/[a-zA-Z0-9_]+|(?=\[\])/g,k=/^$/,n=/^\d+$/,p=/^[a-zA-Z0-9_]+$/;return this.build=function(e,l,g){return e[l]=g,e},this.push_counter=function(e){return void 0===d[e]&&(d[e]=0),d[e]++},a.each(a(this).serializeArray(),function(){if(f.test(this.name)){for(var e,l=this.name.match(h),g=this.value,m=this.name;void 0!==(e=l.pop());)m=m.replace(new RegExp("\\["+e+"\\]$"),""),e.match(k)?
g=b.build([],b.push_counter(m),g):e.match(n)?g=b.build([],e,g):e.match(p)&&(g=b.build({},e,g));c=a.extend(!0,c,g)}}),c}}(jQuery);
var app={loadedPage:!1,breadcrumbTpl:Twig.twig({href:"/template/breadcrumb.twig",async:!1}),setValue:function(a,b){$(b).val($(a).val()).change()},deRequireCb:function(a){el=document.getElementsByClassName(a);a=!1;for(i=0;i<el.length;i++)!0===el[i].checked&&(a=!0);if(!0===a)for(i=0;i<el.length;i++)el[i].required=!1;else for(i=0;i<el.length;i++)el[i].required=!0},flights:{check_waybill:function(){$("select[name='id_driver']").each(function(){var a=$(this).val(),b=$(this).data("id");a=$("#array_drivers row[data-id='"+
a+"']").data("inn");b=$(".btn-waybill[data-id='"+b+"']");a?b.removeClass("d-none"):b.addClass("d-none")})},init:function(){var a=this;0<flights_calendar_within.length&&new Datepicker("#flights_calendar",{multiple:!1,inline:!0,weekStart:1,within:flights_calendar_within,classNames:{node:"datepicker custom"},templates:{container:'<div class="datepicker__container"><% for (var i = -1; i <= 1; i++) { %><div class="datepicker__pane"><%= renderHeader(i) %><%= renderCalendar(i) %></div><% } %></div>'},onChange:function(b){b&&
app.getAjaxPage(null,"/"+shortname+"/flights/"+moment(b).format("DD.MM.YYYY"))},onRender:function(b){$.each(flights_calendar_title,function(c,d){$(b).find('[data-day="'+d.date+'"]').attr("title","\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432: "+d.num)})}});$(".online_save").on("change",function(){var b=$(this).serializeObject(),c=$(this);c.find('[type="checkbox"]').is(":checked")?c.find('[name="id_car"]').attr("disabled",!1):c.find('[name="id_car"]').attr("disabled",
!0);b.timestamp_load=moment(b.timestamp_load).unix();b.timestamp_exit=moment(b.timestamp_exit).unix();$.ajax({url:"/"+shortname+"/api/flights/edit",method:"POST",data:b,dataType:"json",success:function(d){(new Noty({type:"success",layout:"topRight",text:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e",timeout:1E3})).show();c.find('[name="id_car"]').val(d.id_car);c.find('[name="id_car"]').next().find(".select2-selection__rendered").html($("#array_car [data-id='"+d.id_car+"']").data("value")).attr("titile",
$("#array_car [data-id='"+d.id_car+"']").data("value"));a.check_waybill()}})});$(".online_save").submit(function(){return!1});a.check_waybill()}},init:function(){var a=this;$(function(){$("#sidebar-menu").find(".active").removeClass("active");$("#sidebar-menu").find(".collapse").removeClass("show");$("#sidebar-menu").find("[aria-expanded]").attr("aria-expanded","false");$("a.nav-link").each(function(){0<path.indexOf("/flights/")&&0<$(this).attr("href").indexOf("/flights")&&$(this).addClass("active");
0<path.indexOf("/drivers/")&&0<$(this).attr("href").indexOf("/drivers")&&$(this).addClass("active");0<path.indexOf("/cars/")&&0<$(this).attr("href").indexOf("/cars")&&$(this).addClass("active");0<path.indexOf("/settings/")&&0<$(this).attr("href").indexOf("/settings")&&$(this).addClass("active");if($(this).attr("href")==path){$(this).addClass("active");var c=$(this).parents(".sub-nav").attr("id");$(this).parents(".nav-item").each(function(){$(this).find('[data-bs-toggle][aria-controls="'+c+'"]').attr("aria-expanded",
"true")});$(this).parents(".sub-nav").addClass("show");$(this).parents(".sub-nav").each(function(){var d=$(this).attr("data-bs-parent");$("a[href='"+d+"']").attr("aria-expanded","true")})}})});$("[data-clipboard]").each(function(){$(this).click(function(){var c=$(this).data("clipboard"),d=moment().unix();$("body").append("<textarea id='cl"+d+"' readonly='readonly'></textarea>");d=$("#cl"+d);d.val(c).select();document.execCommand("copy");d.remove();(new Noty({type:"success",layout:"bottomRight",text:"\u0421\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430",
timeout:1500})).show()}).attr("data-bs-toggle","tooltip")});if("undefined"!==typeof bootstrap){var b=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));b.map(function(c){return new bootstrap.Tooltip(c)});b=[].slice.call(document.querySelectorAll('[data-sidebar-toggle="tooltip"]'));b.map(function(c){return new bootstrap.Tooltip(c)})}$(".ajax").each(function(){$(this).data("ajax-handler")||($(this).data("ajax-handler",!0),$(this).click(function(){a.getAjaxPage(this);return!1}))});
window.addEventListener("popstate",c=>{a.getAjaxPage("",location.pathname)});a.deRequireCb("user_rights");a.flights.init();$(".js-select2").each(function(){$(this).select2({language:{noResults:function(){return"\u041d\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432... \u00af\u0f3d_(\u30c4)_\u0f3c\u00af"}},placeholder:$(this).attr("placeholder")})})},util:{rand:function(a,b){a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1))+a},addParams:function(a,
b){$.isEmptyObject(b)||(a+=(0<=a.indexOf("?")?"&":"?")+$.param(b));return a},$_GET:function(a){if(a=(new RegExp("[?&]"+encodeURIComponent(a)+"=([^&]*)")).exec(location.search))return decodeURIComponent(a[1])},toggleSub:function(a){$("#"+a+"_sub_tr").toggle()}},getAjaxPage:function(a,b=!1){if(!$(a).hasClass("ajax")&&null!=a)return!0;var c=this;if(c.loadedPage)return!1;c.loadedPage=!0;b||=$(a).attr("href");var d=b;b=c.util.addParams(b,{ajax:!0});$("#load").stop().fadeIn();$("#load .progress-bar").stop().animate({width:c.util.rand(30,
60)+"%"});$.ajax({url:b,dataType:"json",success:function(f){if(f.redirect)return location.pathname=f.redirect,!1;document.title=f.title+" - "+branchname;window.history.pushState({html:f.response,pageTitle:document.title},"",d);path=location.pathname;var h=document.implementation.createHTMLDocument();h.body.innerHTML=f.response;[].map.call(h.getElementsByTagName("script"),function(k){eval(k.textContent)});document.getElementById("content-ajax").innerHTML=f.response;document.getElementById("breadcrumb-ajax").innerHTML=
c.breadcrumbTpl.render({breadcrumb:f.breadcrumb});c.init();$("#load .progress-bar").stop().animate({width:"100%"},function(){$("#load").stop().fadeOut(function(){$("#load .progress-bar").css({width:"0%"});c.loadedPage=!1})})}})}};app.init();
