!function(d){d.fn.serializeObject=function(){var b=this,f={},h={},g=/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,a=/[a-zA-Z0-9_]+|(?=\[\])/g,c=/^$/,l=/^\d+$/,p=/^[a-zA-Z0-9_]+$/;return this.build=function(e,m,k){return e[m]=k,e},this.push_counter=function(e){return void 0===h[e]&&(h[e]=0),h[e]++},d.each(d(this).serializeArray(),function(){if(g.test(this.name)){for(var e,m=this.name.match(a),k=this.value,n=this.name;void 0!==(e=m.pop());)n=n.replace(new RegExp("\\["+e+"\\]$"),""),e.match(c)?
k=b.build([],b.push_counter(n),k):e.match(l)?k=b.build([],e,k):e.match(p)&&(k=b.build({},e,k));f=d.extend(!0,f,k)}}),f}}(jQuery);
app={data:null,init:function(){$("#max-button").hide();$("#close-button").click(function(){window.electronAPI.controll(0)});$("#min-button").click(function(){window.electronAPI.controll(1)});$("#max-button").click(function(){$(this).hide();$("#restore-button").show();window.electronAPI.controll(2)});$("#restore-button").click(function(){$(this).hide();$("#max-button").show();window.electronAPI.controll(2)});this.renderHome()},twig:function(d,b){return window.electronAPI.getTwig(d,b)},renderHome:function(){var d=
this;d.data=window.electronAPI.getData();html=this.twig("home.twig",{data:d.data});$("#content").html(html);flatpickr("#selectRange",{mode:"range",onChange:function(a){if(2==a.length){var c=a[0];a=a[1];$("#selectedDateH2").html("\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u043a: "+moment(c).format("DD.MM.YYYY")+" - "+moment(a).format("DD.MM.YYYY"));d.data=window.electronAPI.setRange([moment(c).unix(),moment(a).unix()]);d.renderHome()}}});
$("table span[type='button']").click(function(){var a=$(this),c=$("#editDay");c.find("#editDayLabel").html("\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u043d\u044f: "+moment.unix(a.data("timestamp")).format("DD.MM.YYYY"));c.find("input[name='date']").val(moment.unix(a.data("timestamp")).format("YYYY-MM-DD"));c.find("input[name='value']").val(a.data("value"));c.find("input[name='old_total']").val(a.data("total"));c.find("input[name='porog']").val(a.data("porog"));
c.find("input[name='percentage']").val(a.data("percentage"));c.find("input[name='id']").val(a.data("id"));c.modal("toggle");$("#formEdit").submit(function(){var l=$(this).serializeObject();l.date=moment(l.date).unix();window.electronAPI.editDay(l);$("#editDay").modal("toggle");d.renderHome();return!1})});$("#formAdd").submit(function(){var a=$(this).serializeObject();a.date=moment(a.date).unix();window.electronAPI.addDay(a);$(this).find("input[name='value']").val("");$(this).find("input[name='date']").val(moment().format("YYYY-MM-DD"));
$("#addDay").modal("toggle");d.renderHome();return!1});const b=" \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442".split(" ");var f={"\u041f\u043d":0,"\u0412\u0442":0,"\u0421\u0440":0,"\u0427\u0442":0,"\u041f\u0442":0};d.data.data.forEach(function(a){if(a)for(var c=1;5>=c;c++)a[c]&&(f[b[c]]||(f[b[c]]=0),f[b[c]]+=a[c].total)});for(var h={"\u041f\u043d":0,"\u0412\u0442":0,"\u0421\u0440":0,"\u0427\u0442":0,"\u041f\u0442":0},g=1;5>=g;g++)h[b[g]]=h[b[g-1]]?h[b[g-1]]+f[b[g]]:f[b[g]];h={data:{labels:["\u041f\u043d",
"\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041f\u0442"],datasets:[{label:"\u041f\u043e \u0434\u043d\u044f\u043c",data:f,borderColor:"#81a8ff",backgroundColor:"#004eff",type:"bar"},{label:"\u0420\u043e\u0441\u0442/\u0421\u043f\u0430\u0434",data:h,borderColor:"#9cff00",backgroundColor:"#9cff00",type:"line"}]}};g=document.getElementById("myChart");new Chart(g,h)},setBalance:function(){var d=this,b=$("#setBalance");b.modal("toggle");$("#formBalance").submit(function(){var f=$(this).serializeObject();
window.electronAPI.setBalance(f);b.modal("toggle");d.renderHome();return!1})},clearBase:function(){var d=this,b=$("#clearBase");b.modal("toggle");$("#form\u0421learBase").submit(function(){window.electronAPI.clearBase();b.modal("toggle");d.renderHome()})}};app.init();
